<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="FrontEdu.Views.GroupChatsPage"
             Title="Групповые чаты">
    <Grid RowDefinitions="Auto,*">
        <!-- Поиск и кнопка создания чата -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" Padding="10">
            <SearchBar Grid.Column="0"
                       Placeholder="Поиск чатов..."
                       TextChanged="OnSearchTextChanged"/>
            <Button Grid.Column="1"
                    Text="+"
                    WidthRequest="50"
                    Clicked="OnCreateGroupChatClicked"/>
        </Grid>

        <!-- Список чатов -->
        <RefreshView Grid.Row="1"
                     x:Name="GroupChatsRefreshView">
            <CollectionView x:Name="GroupChatsCollection"
                          SelectionMode="Single"
                          SelectionChanged="OnGroupChatSelected">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Margin="10,5"
                               Padding="10"
                               BorderColor="{StaticResource Primary}">
                            <Grid RowDefinitions="Auto,Auto,Auto"
                                  ColumnDefinitions="*,Auto">
                                <!-- Название чата -->
                                <Label Grid.Row="0"
                                       Grid.Column="0"
                                       Text="{Binding Name}"
                                       FontAttributes="Bold"/>
                                <!-- Последнее сообщение -->
                                <Label Grid.Row="1"
                                       Grid.Column="0"
                                       Text="{Binding LastMessage.Content}"
                                       FontSize="Small"
                                       TextColor="{StaticResource Gray600}"
                                       LineBreakMode="TailTruncation"/>
                                <!-- Создатель и количество участников -->
                                <Label Grid.Row="2"
                                       Grid.Column="0"
                                       Text="{Binding Creator.FullName}"
                                       FontSize="Small"
                                       TextColor="{StaticResource Gray600}"/>
                                <VerticalStackLayout Grid.Row="0"
                                                    Grid.Column="1"
                                                    Grid.RowSpan="3"
                                                    Spacing="5">
                                    <Label Text="{Binding MembersCount, StringFormat='{0} участников'}"
                                           HorizontalOptions="End"
                                           FontSize="Small"/>
                                    <!-- Непрочитанные сообщения -->
                                    <Label Text="{Binding UnreadCount, StringFormat='{0} новых'}"
                                           IsVisible="{Binding UnreadCount, Converter={StaticResource IntToBoolConverter}}"
                                           HorizontalOptions="End"
                                           FontSize="Small"
                                           TextColor="{StaticResource Primary}"/>
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- Индикатор загрузки -->
        <ActivityIndicator x:Name="LoadingIndicator"
                          Grid.RowSpan="2"
                          IsVisible="False"
                          HorizontalOptions="Center"
                          VerticalOptions="Center"/>
    </Grid>
</ContentPage>